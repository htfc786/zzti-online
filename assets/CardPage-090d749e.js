import{a as R,_ as Z}from"./index-15b4e44c.js";import{g as q,a as ee}from"./questions-02599103.js";import{g as te}from"./index-55ace678.js";function oe(t,n){const r=document.createElement("div"),l=document.createElement("div");l.innerHTML=t,l.style.padding="0 20px",r.style.position="relative",r.appendChild(l);const{width:d,height:u}=n;return r.style.width=d,r.style.height=u,r.style.display="flex",r.style.justifyContent="center",r.style.alignItems="center",r}async function ae(t){const n=document.createElement("div");n.style.width=`${t.width}mm`,n.style.height=`${t.height}mm`,n.style.display="grid",n.style.gridTemplateColumns=`repeat(${t.cols}, 0fr)`,n.style.gridTemplateRows=`repeat(${t.rows}, 1fr)`,n.style.textAlign="center";const r=t.width/t.cols,l=t.height/t.rows,d=document.createDocumentFragment();for(let p=0;p<t.contents.length;p++){const h=t.contents[p],_=oe(h,{width:`${r}mm`,height:`${l}mm`});d.appendChild(_)}n.appendChild(d);const u=document.createElement("div");u.style.position="absolute",u.style.bottom="5mm",u.style.right="5mm",u.innerText=t.pageNum+"",n.appendChild(u),n.style.position="relative";const c=document.createElement("div");c.style.position="absolute",c.style.left="-99999px",c.style.top="-99999px",document.body.appendChild(c),c.appendChild(n);let v="";const V=await R(()=>import("./html2canvas.esm-e0a7d97b.js"),[],import.meta.url);try{v=(await V.default(n,{scale:1})).toDataURL("image/png")}catch(p){console.error("html2canvas 失败:",p)}finally{document.body.removeChild(c)}return v}const S=(t,n)=>`<${n.fontSize} style="color:${n.color}">${t}</${n.fontSize}>`,ne=(t,n,r,l)=>S(t,n)+(r?S(r,l):""),le=(t,n,r,l,d)=>S(t,n)+(r?S(r,l):"")+`<div style="position:absolute;bottom:5mm;right:5mm">${d}</div>`;function j(t,n,r){const{size:l,count:d,showPageNum:u}=n,{x:c,y:v}=d;return{width:l==="horizontal"?297:210,height:l==="horizontal"?210:297,rows:v,cols:c,contents:t,pageNum:`${u?r:""}`}}function re(t,n){const{front:r,back:l,content:d,paper:u}=n,{x:c,y:v}=u.count,V=v*c,p=[];let h=new Array(V).fill(""),_=new Array(V).fill("");for(let g=0;g<t.length;g++){const k=g%V,a=t[g],b=u.contentPosition==="front"&&a.content||"";h[k]=ne(a.front,r,b,d);const z=Math.floor(k/c),B=k%c,I=z*c+c-1-B,m=u.contentPosition==="back"&&a.content||"";if(_[I]=le(a.back,l,m,d,u.showCardNum?g+1:""),k===V-1||g===t.length-1){const x=Math.ceil(g/V)*2-1;p.push(j(h,u,x)),p.push(j(_,u,x+1)),h=new Array(V).fill(""),_=new Array(V).fill("")}}return p}async function ue(t,n){const r=await R(()=>import("./jspdf.es.min-76d05a85.js").then(c=>c.j),["./jspdf.es.min-76d05a85.js","./index-15b4e44c.js","./index-ccc2dd0e.css"],import.meta.url),l=n.size==="horizontal"?"l":"p",d=n.size==="horizontal"?[297,210]:[210,297],u=new r.jsPDF({orientation:l,unit:"mm",format:d});for(let c=0;c<t.length;c++){const v=t[c];u.addImage(v,"JPEG",0,0,d[0],d[1]),c<t.length-1&&u.addPage()}return u.output("blob")}const L=t=>(Vue.pushScopeId("data-v-bc23696e"),t=t(),Vue.popScopeId(),t),ce={id:"CardPage"},se={key:0,class:"editable-row-operations"},ie={key:0},de=L(()=>Vue.createElementVNode("a",null,"取消",-1)),pe={key:1},Ve=["onClick"],me=L(()=>Vue.createElementVNode("a",{style:{color:"red"}},"删除",-1)),ve={key:2},fe={class:"config",style:{"line-height":"24px"}},he=Vue.defineComponent({__name:"CardPage",setup(t){const n=[{title:"#",dataIndex:"index",width:"10%"},{title:"正面",dataIndex:"front"},{title:"反面",dataIndex:"back"},{title:"备注",dataIndex:"content"},{title:"",dataIndex:"operation"}],r=Vue.ref(),l=Vue.reactive({}),d=s=>JSON.parse(JSON.stringify(s)),u=s=>{l[s]=d(m.value[s])},c=s=>{Object.assign(m.value[s],l[s]),delete l[s]},v=s=>{delete l[s]},V=s=>{m.value.splice(s,1),delete l[s]},p=()=>{m.value.push({front:"",back:"",content:""}),u(m.value.length-1);const s=r.value.$el;requestAnimationFrame(()=>{s.scrollTo(0,s.scrollHeight)})},h=[{label:"h1",value:"h1"},{label:"h2",value:"h2"},{label:"h3",value:"h3"},{label:"h4",value:"h4"},{label:"h5",value:"h5"},{label:"h6",value:"h6"}],_=[{label:"黑",value:"black"},{label:"灰",value:"grey"},{label:"红",value:"red"},{label:"蓝",value:"blue"}],g=[{label:"A4(横)",value:"horizontal"},{label:"A4(竖)",value:"vertical"}],k=[{label:"正面",value:"front"},{label:"反面",value:"back"}],a=Vue.ref({front:{fontSize:"h2",color:"black"},back:{fontSize:"h3",color:"black"},content:{fontSize:"h5",color:"grey"},paper:{size:"horizontal",count:{x:8,y:4},contentPosition:"front",showCardNum:!0,showPageNum:!0}}),b=Vue.ref([]),z=Vue.ref(0),B=async()=>{if(m.value.length===0){antd.message.error("请添加卡片数据");return}const s=antd.message.loading("生成中...",0);z.value=0;const e=re(m.value,a.value);b.value=[];for(let i=0;i<e.length;i++){const f=e[i],N=await ae(f),D=document.createElement("img");D.src=N,b.value.push(N),z.value=Math.floor((i+1)/e.length*100)}s()},I=async()=>{if(b.value.length===0){antd.message.error("请先生成卡片");return}if(z.value!==100){antd.message.error("卡片还未生成完成");return}const s=antd.message.loading("导出中...",0),e=await ue(b.value,a.value.paper);s();const i=URL.createObjectURL(e),f=document.createElement("a");f.href=i;const N=antd.Modal.success({title:"导出成功",content:"点击下载按钮下载卡片",footer:()=>Vue.h("div",{style:"display: flex; flex-direction: row-reverse;"},[Vue.h(antd.Button,{type:"primary",onClick:()=>{f.download="卡片.pdf",f.click(),N.destroy()}},{default:()=>"下载"}),Vue.h(antd.Button,{style:"margin-right: 8px;",onClick:()=>{f.target="_blank",f.click(),N.destroy()}},{default:()=>"预览"}),Vue.h(antd.Button,{style:"margin-right: 8px;",onClick:()=>{N.destroy()}},{default:()=>"取消"})])})},m=Vue.ref([]),x=Vue.ref(!1),P=Vue.ref(["\\"]),M=q(),F=()=>{x.value=!0},H=()=>{x.value=!1;const s=ee(P.value),e=te(s);e==null||e.forEach(i=>{m.value.push({front:i==null?void 0:i.q,back:(i==null?void 0:i.ans)||"",content:(i==null?void 0:i.con)||""})}),P.value=["\\"]},J=()=>{x.value=!1};return(s,e)=>{const i=Vue.resolveComponent("a-typography-link"),f=Vue.resolveComponent("a-popconfirm"),N=Vue.resolveComponent("a-input"),D=Vue.resolveComponent("a-table"),E=Vue.resolveComponent("a-button"),y=Vue.resolveComponent("a-row"),w=Vue.resolveComponent("a-select"),O=Vue.resolveComponent("a-input-number"),A=Vue.resolveComponent("a-switch"),U=Vue.resolveComponent("a-col"),Q=Vue.resolveComponent("a-image"),W=Vue.resolveComponent("a-list-item"),G=Vue.resolveComponent("a-list"),X=Vue.resolveComponent("a-progress"),K=Vue.resolveComponent("a-tree-select"),Y=Vue.resolveComponent("a-modal");return Vue.openBlock(),Vue.createElementBlock("div",ce,[Vue.createVNode(y,{type:"flex"},{default:Vue.withCtx(()=>[Vue.createVNode(U,{class:"left",span:12},{default:Vue.withCtx(()=>[Vue.createVNode(D,{class:"table",columns:n,"data-source":m.value,bordered:"",pagination:!1,ref_key:"tableRef",ref:r},{bodyCell:Vue.withCtx(({column:o,text:$,index:C})=>[o.dataIndex==="operation"?(Vue.openBlock(),Vue.createElementBlock("div",se,[l[C]?(Vue.openBlock(),Vue.createElementBlock("span",ie,[Vue.createVNode(i,{onClick:T=>c(C),style:{"margin-right":"2px"}},{default:Vue.withCtx(()=>[Vue.createTextVNode("保存")]),_:2},1032,["onClick"]),Vue.createVNode(f,{title:"放弃更改?",onConfirm:T=>v(C)},{default:Vue.withCtx(()=>[de]),_:2},1032,["onConfirm"])])):(Vue.openBlock(),Vue.createElementBlock("span",pe,[Vue.createElementVNode("a",{onClick:T=>u(C),style:{"margin-right":"2px"}},"编辑",8,Ve),Vue.createVNode(f,{title:"确定删除?",onConfirm:T=>V(C)},{default:Vue.withCtx(()=>[me]),_:2},1032,["onConfirm"])]))])):o.dataIndex==="index"?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:1},[Vue.createTextVNode(Vue.toDisplayString(C+1),1)],64)):(Vue.openBlock(),Vue.createElementBlock("div",ve,[l[C]?(Vue.openBlock(),Vue.createBlock(N,{key:0,value:l[C][o.dataIndex],"onUpdate:value":T=>l[C][o.dataIndex]=T,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:1},[Vue.createTextVNode(Vue.toDisplayString($),1)],64))]))]),_:1},8,["data-source"]),Vue.createElementVNode("div",fe,[Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createVNode(E,{type:"primary",onClick:F},{default:Vue.withCtx(()=>[Vue.createTextVNode("导入数据")]),_:1}),Vue.createVNode(E,{onClick:p},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加信息")]),_:1})]),_:1}),Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createTextVNode("正面： 字号："),Vue.createVNode(w,{size:"small",value:a.value.front.fontSize,"onUpdate:value":e[0]||(e[0]=o=>a.value.front.fontSize=o),options:h},null,8,["value"]),Vue.createTextVNode(" 字色："),Vue.createVNode(w,{size:"small",value:a.value.front.color,"onUpdate:value":e[1]||(e[1]=o=>a.value.front.color=o),options:_},null,8,["value"])]),_:1}),Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createTextVNode("反面： 字号："),Vue.createVNode(w,{size:"small",value:a.value.back.fontSize,"onUpdate:value":e[2]||(e[2]=o=>a.value.back.fontSize=o),options:h},null,8,["value"]),Vue.createTextVNode(" 字色："),Vue.createVNode(w,{size:"small",value:a.value.back.color,"onUpdate:value":e[3]||(e[3]=o=>a.value.back.color=o),options:_},null,8,["value"])]),_:1}),Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createTextVNode("备注： 字号："),Vue.createVNode(w,{size:"small",value:a.value.content.fontSize,"onUpdate:value":e[4]||(e[4]=o=>a.value.content.fontSize=o),options:h},null,8,["value"]),Vue.createTextVNode(" 字色："),Vue.createVNode(w,{size:"small",value:a.value.content.color,"onUpdate:value":e[5]||(e[5]=o=>a.value.content.color=o),options:_},null,8,["value"]),Vue.createTextVNode(" 位置："),Vue.createVNode(w,{size:"small",value:a.value.paper.contentPosition,"onUpdate:value":e[6]||(e[6]=o=>a.value.paper.contentPosition=o),options:k},null,8,["value"])]),_:1}),Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createTextVNode("页面配置： 纸张："),Vue.createVNode(w,{size:"small",value:a.value.paper.size,"onUpdate:value":e[7]||(e[7]=o=>a.value.paper.size=o),options:g},null,8,["value"]),Vue.createTextVNode(" 个数："),Vue.createVNode(O,{size:"small",min:1,max:100,style:{width:"50px"},value:a.value.paper.count.x,"onUpdate:value":e[8]||(e[8]=o=>a.value.paper.count.x=o)},null,8,["value"]),Vue.createTextVNode(" X "),Vue.createVNode(O,{size:"small",min:1,max:100,style:{width:"50px"},value:a.value.paper.count.y,"onUpdate:value":e[9]||(e[9]=o=>a.value.paper.count.y=o)},null,8,["value"])]),_:1}),Vue.createVNode(y,{type:"flex",justify:"space-between"},{default:Vue.withCtx(()=>[Vue.createVNode(U,null,{default:Vue.withCtx(()=>[Vue.createTextVNode(" 卡片页码："),Vue.createVNode(A,{checked:a.value.paper.showCardNum,"onUpdate:checked":e[10]||(e[10]=o=>a.value.paper.showCardNum=o)},null,8,["checked"]),Vue.createTextVNode(" 页码："),Vue.createVNode(A,{checked:a.value.paper.showPageNum,"onUpdate:checked":e[11]||(e[11]=o=>a.value.paper.showPageNum=o)},null,8,["checked"])]),_:1}),Vue.createVNode(E,{style:{"margin-left":"8px"},type:"primary",onClick:B},{default:Vue.withCtx(()=>[Vue.createTextVNode("生成卡片")]),_:1})]),_:1})])]),_:1}),Vue.createVNode(U,{class:"right",span:12},{default:Vue.withCtx(()=>[Vue.createVNode(G,{size:"small",bordered:"","data-source":b.value,class:"card-list"},{renderItem:Vue.withCtx(({item:o,index:$})=>[Vue.createVNode(W,null,{default:Vue.withCtx(()=>[Vue.createTextVNode(" 第"+Vue.toDisplayString($+1)+"张 ",1),Vue.createVNode(Q,{width:200,src:o},null,8,["src"])]),_:2},1024)]),_:1},8,["data-source"]),Vue.createVNode(y,{type:"flex",justify:"start"},{default:Vue.withCtx(()=>[Vue.createVNode(X,{percent:z.value,style:{"margin-left":"16px"}},null,8,["percent"])]),_:1}),Vue.createVNode(y,{type:"flex",justify:"end"},{default:Vue.withCtx(()=>[Vue.createVNode(E,{type:"primary",onClick:I},{default:Vue.withCtx(()=>[Vue.createTextVNode("导出PDF")]),_:1})]),_:1})]),_:1})]),_:1}),Vue.createVNode(Y,{open:x.value,"onUpdate:open":e[13]||(e[13]=o=>x.value=o),title:"导入数据",onOk:H,onCancel:J},{default:Vue.withCtx(()=>[Vue.createVNode(K,{value:P.value,"onUpdate:value":e[12]||(e[12]=o=>P.value=o),"tree-data":Vue.unref(M),style:{width:"100%"},"tree-checkable":"","allow-clear":"","show-checked-strategy":Vue.unref(antd.TreeSelect).SHOW_PARENT,placeholder:"Please select","tree-node-filter-prop":"label","tree-line":!0},null,8,["value","tree-data","show-checked-strategy"])]),_:1},8,["open"])])}}});const Ce=Z(he,[["__scopeId","data-v-bc23696e"]]);export{Ce as default};
